{% extends "dashboard/base.html" %}

{% block title %} ìº˜ë¦°ë” ì„¤ì • | {{ super() }} {% endblock title %}

{% block content %}
    <div class="container mt-3">
        <div class="row">
            <div class="col">
                <h3> ğŸ“† êµ¬ê¸€ ìº˜ë¦°ë”-> Application ì—°ë™</h3>
            </div>
        </div>

        <div class="row mt-3 justify-content-center">
            <h6> ë‚˜ì˜ êµ¬ê¸€ê³„ì • ìº˜ë¦°ë” ëª©ë¡</h6>
            <table style="border: 1px solid; width: 80%;">
                <tr>
                    <th>Calendar Name</th>
                    <th>Calendar ID</th>
                    <th>Action</th>
                </tr>
                {% for calendar in calendars %}
                    <tr id="calendarRow_{{ loop.index }}">
                        <th>{{ calendar.name }}</th>
                        <th>{{ calendar.google_calendar_id }}</th>
                        <th>
                            {# ë‚´ ìº˜ë¦°ë”ê°€ synced_calendarsì— í¬í•¨ì‹œ, ì—°ë™ì¤‘ìœ¼ë¡œ í‘œì‹œ #}
                            {% if calendar in synced_calendars %}
                                <button
                                        id="syncBtn_{{ loop.index }}"
                                        class='btn btn-sm btn-success'
                                >
                                    ì—°ë™ ì¤‘
                                </button>
                            {% else %}
                                {# í¬í•¨ì•ˆë˜ì–´ìˆìœ¼ë©´, ê¸°ì¡´ì˜ ì—°ë™ìœ¼ë¡œ í‘œì‹œ #}
                                <button id="syncBtn_{{ loop.index }}"
                                        class='btn btn-sm btn-auth'
                                        hx-post='{{ url_for("hx_create_calendar_syncs") }}'
                                        hx-vals='{"user_id": "{{ user.id }}", "calendar_id" : "{{ calendar.id }}", "loop_index": "{{ loop.index }}" }'
                                        hx-target="#syncedCalendarTable"
                                        hx-swap="beforeend swap:1s"
                                >
                                    ì—°ë™
                                </button>
                            {% endif %}
                        </th>
                    </tr>
                {% endfor %}
            </table>
        </div>

        <div class="row mt-3 justify-content-center">
            <h6> Sync ìº˜ë¦°ë” ëª©ë¡</h6>
            {#            <table style="border: 1px solid; width: 80%;">#}
            <table style="border: 1px solid; width: 80%;" id="syncedCalendarTable">
                <tr>
                    <th>Calendar Name</th>
                    <th>Calendar ID</th>
                    <th>Action</th>
                </tr>
                {% for synced_calendar in synced_calendars %}
                    <tr>
                        <th>{{ synced_calendar.name }}</th>
                        <th>{{ synced_calendar.google_calendar_id }}</th>
                        <th>
                            <button
                                    id="syncCancelBtn_{{ loop.index }}"
                                    class='btn btn-sm btn-danger'
                                    hx-post='{{ url_for("hx_delete_calendar_syncs") }}'
                                    hx-vals='{"user_id": "{{ user.id }}", "calendar_id" : "{{ synced_calendar.id }}", "loop_index": "0" }'
                                    hx-target="#syncedCalendarTable"
                                    hx-swap="outerHTML"
                            >
                                ì—°ë™ ì·¨ì†Œ
                            </button>
                        </th>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
{% endblock content %}
